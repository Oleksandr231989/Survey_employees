<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024 Annual Performance Review Cycle - Employees Survey</title>
    <style>
        /* General styling */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background-color: #2563eb;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .header p {
            margin-top: 8px;
            font-size: 0.9rem;
        }
        
        .form-container {
            padding: 24px;
        }
        
        /* Section styling */
        .section-header {
            background-color: #dbeafe;
            color: #1e40af;
            padding: 12px;
            margin-bottom: 24px;
            border-radius: 6px;
        }
        
        .section-header h2 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        /* Question styling */
        .question {
            margin-bottom: 32px;
        }
        
        .question label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .question .description {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .question .required {
            color: #dc2626;
        }
        
        .option {
            margin-bottom: 8px;
        }
        
        .option label {
            display: flex;
            align-items: center;
            font-weight: normal;
        }
        
        .option input[type="radio"] {
            margin-right: 8px;
        }
        
        /* Form controls */
        select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
        }
        
        select:focus, textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Buttons */
        .button-group {
            display: flex;
            justify-content: flex-end;
            margin-top: 24px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-submit {
            background-color: #10b981;
            color: white;
        }
        
        .btn-submit:hover {
            background-color: #059669;
        }
        
        /* Error messages */
        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 4px;
            display: none;
        }
        
        .error .error-message {
            display: block;
        }
        
        .error select, .error textarea {
            border-color: #dc2626;
        }
        
        /* Conditional questions */
        .conditional-question {
            margin-left: 24px;
            padding-left: 16px;
            border-left: 2px solid #93c5fd;
            margin-bottom: 24px;
            display: none;
        }
        
        /* Thank you message */
        .thank-you {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }
        
        .thank-you h2 {
            color: #10b981;
            margin-bottom: 16px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 16px;
            font-size: 0.875rem;
            color: #6b7280;
        }

        /* Loading indicator */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            display: none;
        }
        
        .is-loading .loading-text {
            display: inline;
        }
        
        .is-loading .normal-text {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>2024 Annual Performance Review Cycle - Employees Survey</h1>
            <p>Your feedback will help us make your next experience even better!</p>
        </div>
        
        <div id="surveyForm" class="form-container">
            <div class="question" id="countryQuestion">
                <label for="country">Select your country: <span class="required">*</span></label>
                <select id="country" name="country">
                    <option value="">-- Select Country --</option>
                    <option value="Belgium">Belgium</option>
                    <option value="Canada">Canada</option>
                    <option value="Estonia">Estonia</option>
                    <option value="Finland">Finland</option>
                    <option value="France">France</option>
                    <option value="Latvia">Latvia</option>
                    <option value="Lithuania">Lithuania</option>
                    <option value="Mexico">Mexico</option>
                    <option value="Morocco">Morocco</option>
                    <option value="Poland">Poland</option>
                    <option value="Portugal">Portugal</option>
                    <option value="Romania">Romania</option>
                    <option value="Russia">Russia</option>
                    <option value="Turkey">Turkey</option>
                    <option value="Ukraine">Ukraine</option>
                    <option value="USA">USA</option>
                    <option value="Vietnam">Vietnam</option>
                </select>
                <div class="error-message">Please select your country</div>
            </div>
            
            <div class="question" id="q1Question">
                <label>1. How satisfied are you with the 2024 annual performance review cycle? <span class="required">*</span></label>
                <div class="option">
                    <label>
                        <input type="radio" name="q1" value="Fully satisfied">
                        Fully satisfied
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q1" value="Mostly satisfied">
                        Mostly satisfied
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q1" value="Mostly unsatisfied">
                        Mostly unsatisfied
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q1" value="Very unsatisfied">
                        Very unsatisfied
                    </label>
                </div>
                <div class="error-message">Please select an option</div>
            </div>
            
            <div class="question" id="q2Question">
                <label>2. What were the strengths of the 2024 annual performance review? <span class="required">*</span></label>
                <div class="option">
                    <label>
                        <input type="radio" name="q2" value="Process">
                        Process
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q2" value="Tool">
                        Tool
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q2" value="Clarity of communication">
                        Clarity of communication
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q2" value="All of the above">
                        All of the above
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q2" value="None">
                        None
                    </label>
                </div>
                <div class="error-message">Please select an option</div>
            </div>
            
            <div class="question" id="q3Question">
                <label for="q3">3. What would be your recommendations for improvement for the 2024 annual performance review? <span class="required">*</span></label>
                <textarea id="q3" name="q3"></textarea>
                <div class="error-message">Please provide your response</div>
            </div>
            
            <div class="question" id="q4Question">
                <label>4. Did you face any challenges during the 2024 annual performance review? <span class="required">*</span></label>
                <div class="option">
                    <label>
                        <input type="radio" name="q4" value="Yes" onchange="toggleConditionalQuestion('q5ConditionalQuestion', true)">
                        Yes
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q4" value="No" onchange="toggleConditionalQuestion('q5ConditionalQuestion', false)">
                        No
                    </label>
                </div>
                <div class="error-message">Please select an option</div>
            </div>
            
            <div class="conditional-question" id="q5ConditionalQuestion">
                <div class="question" id="q5Question">
                    <label>5. If yes, please specify the main challenge? <span class="required">*</span></label>
                    <div class="option">
                        <label>
                            <input type="radio" name="q5" value="Tool">
                            Tool
                        </label>
                    </div>
                    <div class="option">
                        <label>
                            <input type="radio" name="q5" value="Process">
                            Process
                        </label>
                    </div>
                    <div class="option">
                        <label>
                            <input type="radio" name="q5" value="Clarity of communication">
                            Clarity of communication
                        </label>
                    </div>
                    <div class="option">
                        <label>
                            <input type="radio" name="q5" value="All of the above">
                            All of the above
                        </label>
                    </div>
                    <div class="error-message">Please select an option</div>
                </div>
            </div>
            
            <div class="question" id="q6Question">
                <label>6. How would you assess the support while participating in the 2024 annual performance review? <span class="required">*</span></label>
                <p class="description">(presentation of the performance review campaign, access to information, Workday navigation understanding, answers provided, etc.)</p>
                <div class="option">
                    <label>
                        <input type="radio" name="q6" value="Excellent">
                        Excellent
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q6" value="Good">
                        Good
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q6" value="Light">
                        Light
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q6" value="Very light">
                        Very light
                    </label>
                </div>
                <div class="error-message">Please select an option</div>
            </div>
            
            <div class="question" id="q7Question">
                <label>7. How would you assess the quality of the discussion with your manager while participating in the 2024 annual performance review? <span class="required">*</span></label>
                <div class="option">
                    <label>
                        <input type="radio" name="q7" value="Fully satisfied">
                        Fully satisfied
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q7" value="Mostly satisfied">
                        Mostly satisfied
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q7" value="Mostly unsatisfied">
                        Mostly unsatisfied
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q7" value="Very unsatisfied">
                        Very unsatisfied
                    </label>
                </div>
                <div class="error-message">Please select an option</div>
            </div>
            
            <div class="button-group">
                <button type="button" class="btn-submit" onclick="submitForm()">
                    <span class="spinner" style="display: none;"></span>
                    <span class="normal-text">Submit</span>
                    <span class="loading-text">Submitting...</span>
                </button>
            </div>
        </div>
        
        <!-- Thank You Page -->
        <div id="thankYouPage" class="thank-you">
            <h2>Thank You!</h2>
            <p>Your feedback has been successfully submitted.</p>
            <p>Your responses will help us improve the performance review process.</p>
        </div>
    </div>
    
    <div class="footer">
        <p>All required fields are marked with an asterisk (*)</p>
    </div>
    
    <script>
        // Function to toggle conditional questions
        function toggleConditionalQuestion(questionId, show) {
            const question = document.getElementById(questionId);
            if (show) {
                question.style.display = 'block';
            } else {
                question.style.display = 'none';
                // Clear any inputs in the hidden conditional question
                const inputs = question.querySelectorAll('input[type="radio"]');
                inputs.forEach(input => input.checked = false);
                
                // Clear any error state
                const errorContainer = question.querySelector('.question');
                if (errorContainer) errorContainer.classList.remove('error');
            }
        }
        
        // Function to validate a question and show/hide error message
        function validateQuestion(questionId, isRequired = true) {
            if (!isRequired) return true;
            
            const question = document.getElementById(questionId);
            let isValid = false;
            
            // For radio buttons
            const radios = question.querySelectorAll('input[type="radio"]');
            if (radios.length > 0) {
                isValid = Array.from(radios).some(radio => radio.checked);
            }
            
            // For select elements
            const select = question.querySelector('select');
            if (select) {
                isValid = select.value !== '';
            }
            
            // For textarea elements
            const textarea = question.querySelector('textarea');
            if (textarea) {
                isValid = textarea.value.trim() !== '';
            }
            
            // Toggle error class
            if (isValid) {
                question.classList.remove('error');
            } else {
                question.classList.add('error');
            }
            
            return isValid;
        }
        
        // Function to validate the entire form
        function validateForm() {
            let isValid = true;
            
            // Required fields
            isValid = validateQuestion('countryQuestion') && isValid;
            isValid = validateQuestion('q1Question') && isValid;
            isValid = validateQuestion('q2Question') && isValid;
            isValid = validateQuestion('q3Question') && isValid;
            isValid = validateQuestion('q4Question') && isValid;
            
            // Conditional validation for q5
            const q4YesRadio = document.querySelector('input[name="q4"][value="Yes"]');
            if (q4YesRadio && q4YesRadio.checked) {
                isValid = validateQuestion('q5Question') && isValid;
            }
            
            isValid = validateQuestion('q6Question') && isValid;
            isValid = validateQuestion('q7Question') && isValid;
            
            return isValid;
        }
        
        // Function to submit the form
        async function submitForm() {
            if (validateForm()) {
                // Show loading state
                const submitButton = document.querySelector('.btn-submit');
                submitButton.disabled = true;
                submitButton.querySelector('.spinner').style.display = 'inline-block';
                submitButton.classList.add('is-loading');
                
                try {
                    // Collect form data
                    const formData = {
                        country: document.getElementById('country').value,
                        satisfaction_level: document.querySelector('input[name="q1"]:checked')?.value || '',
                        strengths: document.querySelector('input[name="q2"]:checked')?.value || '',
                        improvement_recommendations: document.getElementById('q3').value,
                        faced_challenges: document.querySelector('input[name="q4"]:checked')?.value === 'Yes',
                        main_challenge: document.querySelector('input[name="q5"]:checked')?.value || null,
                        support_assessment: document.querySelector('input[name="q6"]:checked')?.value || '',
                        manager_discussion_quality: document.querySelector('input[name="q7"]:checked')?.value || ''
                    };
                    
                    console.log('Form data being sent:', JSON.stringify(formData));
                    
                    // Use XMLHttpRequest instead of fetch to ensure proper error handling
                    const xhr = new XMLHttpRequest();
                    xhr.open('POST', '/api/submit-survey.js');  // CHANGED LINE - added .js extension
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    
                    xhr.onload = function() {
                        if (xhr.status >= 200 && xhr.status < 300) {
                            console.log('Success response:', xhr.responseText);
                            try {
                                const result = JSON.parse(xhr.responseText);
                                // Show thank you page
                                document.getElementById('surveyForm').style.display = 'none';
                                document.getElementById('thankYouPage').style.display = 'block';
                                window.scrollTo(0, 0);
                            } catch (e) {
                                console.error('Error parsing response:', e);
                                alert('Error processing response. Please try again or contact support.');
                                
                                // Reset button state
                                submitButton.disabled = false;
                                submitButton.querySelector('.spinner').style.display = 'none';
                                submitButton.classList.remove('is-loading');
                            }
                        } else {
                            console.error('Error response:', xhr.status, xhr.responseText);
                            try {
                                const errorResult = JSON.parse(xhr.responseText);
                                alert('Error: ' + (errorResult.error || 'Failed to submit survey') + '. Please try again or contact support.');
                            } catch (e) {
                                alert('Error submitting survey. Please try again or contact support.');
                            }
                            
                            // Reset button state
                            submitButton.disabled = false;
                            submitButton.querySelector('.spinner').style.display = 'none';
                            submitButton.classList.remove('is-loading');
                        }
                    };
                    
                    xhr.onerror = function() {
                        console.error('Network error occurred');
                        alert('Network error occurred. Please check your connection and try again.');
                        
                        // Reset button state
                        submitButton.disabled = false;
                        submitButton.querySelector('.spinner').style.display = 'none';
                        submitButton.classList.remove('is-loading');
                    };
                    
                    xhr.send(JSON.stringify(formData));
                } catch (error) {
                    console.error('Error submitting form:', error);
                    alert('Error: ' + error.message + '. Please try again or contact support.');
                    
                    // Reset button state
                    submitButton.disabled = false;
                    submitButton.querySelector('.spinner').style.display = 'none';
                    submitButton.classList.remove('is-loading');
                }
            } else {
                // Scroll to the first error
                const firstError = document.querySelector('.error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }
        
        // Initialize conditional questions
        document.addEventListener('DOMContentLoaded', function() {
            // Check if any conditional question should be visible initially
            const q4YesRadio = document.querySelector('input[name="q4"][value="Yes"]');
            if (q4YesRadio && q4YesRadio.checked) {
                toggleConditionalQuestion('q5ConditionalQuestion', true);
            }
        });
    </script>
</body>
</html>
