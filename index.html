<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024 Annual Performance Review Cycle - Employees Survey</title>
    <style>
        /* General styling */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background-color: #2563eb;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            padding-top: 60px; /* Increased to make room for the toggle */
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .header p {
            margin-top: 8px;
            font-size: 0.9rem;
        }
        
        .form-container {
            padding: 24px;
        }
        
        /* Section styling */
        .section-header {
            background-color: #dbeafe;
            color: #1e40af;
            padding: 12px;
            margin-bottom: 24px;
            border-radius: 6px;
        }
        
        .section-header h2 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        /* Question styling */
        .question {
            margin-bottom: 32px;
        }
        
        .question label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .question .description {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .question .required {
            color: #dc2626;
        }
        
        .option {
            margin-bottom: 8px;
        }
        
        .option label {
            display: flex;
            align-items: center;
            font-weight: normal;
        }
        
        .option input[type="radio"] {
            margin-right: 8px;
        }
        
        /* Form controls */
        select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
        }
        
        select:focus, textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Buttons */
        .button-group {
            display: flex;
            justify-content: flex-end;
            margin-top: 24px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-submit {
            background-color: #10b981;
            color: white;
        }
        
        .btn-submit:hover {
            background-color: #059669;
        }
        
        /* Error messages */
        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 4px;
            display: none;
        }
        
        .error .error-message {
            display: block;
        }
        
        .error select, .error textarea {
            border-color: #dc2626;
        }
        
        /* Conditional questions */
        .conditional-question {
            margin-left: 24px;
            padding-left: 16px;
            border-left: 2px solid #93c5fd;
            margin-bottom: 24px;
            display: none;
        }
        
        /* Thank you message */
        .thank-you {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }
        
        .thank-you h2 {
            color: #10b981;
            margin-bottom: 16px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 16px;
            font-size: 0.875rem;
            color: #6b7280;
        }

        /* Loading indicator */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            display: none;
        }
        
        .is-loading .loading-text {
            display: inline;
        }
        
        .is-loading .normal-text {
            display: none;
        }
        
        /* Language Toggle */
        .language-toggle {
            position: absolute;
            top: 15px; /* Moved to top */
            right: 15px;
            display: flex;
            background-color: white;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            z-index: 10; /* Ensure it's on top */
        }
        
        .language-toggle button {
            background: none;
            border: none;
            color: #2563eb;
            padding: 6px 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }
        
        .language-toggle button.active {
            background-color: #2563eb;
            color: white;
        }
        
        .language-toggle button:hover:not(.active) {
            background-color: #f3f4f6;
        }
        
        @media (max-width: 640px) {
            .header {
                padding-top: 25px;
            }
            
            .language-toggle {
                top: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-toggle">
                <button id="en-toggle" class="active" onclick="toggleLanguage('en')">EN</button>
                <button id="fr-toggle" onclick="toggleLanguage('fr')">FR</button>
            </div>
            <h1 id="header-title">2024 Annual Performance Review Cycle - Employees Survey</h1>
            <p id="header-description">Your feedback will help us make your next experience even better!</p>
        </div>
        
        <div id="surveyForm" class="form-container">
            <div class="question" id="countryQuestion">
                <label for="country" id="country-label">Select your country: <span class="required">*</span></label>
                <select id="country" name="country">
                    <option value="">-- Select Country --</option>
                    <option value="Belgium">Belgium</option>
                    <option value="Canada">Canada</option>
                    <option value="Estonia">Estonia</option>
                    <option value="Finland">Finland</option>
                    <option value="France">France</option>
                    <option value="Latvia">Latvia</option>
                    <option value="Lithuania">Lithuania</option>
                    <option value="Mexico">Mexico</option>
                    <option value="Morocco">Morocco</option>
                    <option value="Poland">Poland</option>
                    <option value="Portugal">Portugal</option>
                    <option value="Romania">Romania</option>
                    <option value="Russia">Russia</option>
                    <option value="Turkey">Turkey</option>
                    <option value="Ukraine">Ukraine</option>
                    <option value="USA">USA</option>
                    <option value="Vietnam">Vietnam</option>
                </select>
                <div class="error-message" id="country-error">Please select your country</div>
            </div>
            
            <div class="question" id="q1Question">
                <label id="q1-label">1. How satisfied are you with the 2024 annual performance review cycle? <span class="required">*</span></label>
                <div class="option">
                    <label>
                        <input type="radio" name="q1" value="Fully satisfied">
                        <span id="q1-option1">Fully satisfied</span>
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q1" value="Mostly satisfied">
                        <span id="q1-option2">Mostly satisfied</span>
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q1" value="Mostly unsatisfied">
                        <span id="q1-option3">Mostly unsatisfied</span>
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q1" value="Very unsatisfied">
                        <span id="q1-option4">Very unsatisfied</span>
                    </label>
                </div>
                <div class="error-message" id="q1-error">Please select an option</div>
            </div>
            
            <div class="question" id="q2Question">
                <label for="q2" id="q2-label">2. What were the strengths of the 2024 annual performance review? <span class="required">*</span></label>
                <textarea id="q2" name="q2"></textarea>
                <div class="error-message" id="q2-error">Please provide your response</div>
            </div>
            
            <div class="question" id="q3Question">
                <label for="q3" id="q3-label">3. What would be your recommendations for improvement for the 2024 annual performance review? <span class="required">*</span></label>
                <textarea id="q3" name="q3"></textarea>
                <div class="error-message" id="q3-error">Please provide your response</div>
            </div>
            
            <div class="question" id="q4Question">
                <label id="q4-label">4. Did you face any challenges during the 2024 annual performance review? <span class="required">*</span></label>
                <div class="option">
                    <label>
                        <input type="radio" name="q4" value="Yes" onchange="toggleConditionalQuestion('q5ConditionalQuestion', true)">
                        <span id="q4-option1">Yes</span>
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q4" value="No" onchange="toggleConditionalQuestion('q5ConditionalQuestion', false)">
                        <span id="q4-option2">No</span>
                    </label>
                </div>
                <div class="error-message" id="q4-error">Please select an option</div>
            </div>
            
            <div class="conditional-question" id="q5ConditionalQuestion">
                <div class="question" id="q5Question">
                    <label id="q5-label">5. If yes, please specify the main challenge? <span class="required">*</span></label>
                    <div class="option">
                        <label>
                            <input type="radio" name="q5" value="Tool">
                            <span id="q5-option1">Tool</span>
                        </label>
                    </div>
                    <div class="option">
                        <label>
                            <input type="radio" name="q5" value="Process">
                            <span id="q5-option2">Process</span>
                        </label>
                    </div>
                    <div class="option">
                        <label>
                            <input type="radio" name="q5" value="Clarity of communication">
                            <span id="q5-option3">Clarity of communication</span>
                        </label>
                    </div>
                    <div class="option">
                        <label>
                            <input type="radio" name="q5" value="All of the above">
                            <span id="q5-option4">All of the above</span>
                        </label>
                    </div>
                    <div class="error-message" id="q5-error">Please select an option</div>
                </div>
            </div>
            
            <div class="question" id="q6Question">
                <label id="q6-label">6. How would you assess the support while participating in the 2024 annual performance review? <span class="required">*</span></label>
                <p class="description" id="q6-description">(presentation of the performance review campaign, access to information, Workday navigation understanding, answers provided, etc.)</p>
                <div class="option">
                    <label>
                        <input type="radio" name="q6" value="Excellent">
                        <span id="q6-option1">Excellent</span>
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q6" value="Good">
                        <span id="q6-option2">Good</span>
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q6" value="Light">
                        <span id="q6-option3">Light</span>
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q6" value="Very light">
                        <span id="q6-option4">Very light</span>
                    </label>
                </div>
                <div class="error-message" id="q6-error">Please select an option</div>
            </div>
            
            <div class="question" id="q7Question">
                <label id="q7-label">7. How would you assess the quality of the discussion with your manager while participating in the 2024 annual performance review? <span class="required">*</span></label>
                <div class="option">
                    <label>
                        <input type="radio" name="q7" value="Fully satisfied">
                        <span id="q7-option1">Fully satisfied</span>
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q7" value="Mostly satisfied">
                        <span id="q7-option2">Mostly satisfied</span>
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q7" value="Mostly unsatisfied">
                        <span id="q7-option3">Mostly unsatisfied</span>
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="radio" name="q7" value="Very unsatisfied">
                        <span id="q7-option4">Very unsatisfied</span>
                    </label>
                </div>
                <div class="error-message" id="q7-error">Please select an option</div>
            </div>
            
            <div class="button-group">
                <button type="button" class="btn-submit" onclick="submitForm()">
                    <span class="spinner" style="display: none;"></span>
                    <span class="normal-text" id="submit-button">Submit</span>
                    <span class="loading-text" id="submitting-text">Submitting...</span>
                </button>
            </div>
        </div>
        
        <!-- Thank You Page -->
        <div id="thankYouPage" class="thank-you">
            <h2 id="thank-you-title">Thank You!</h2>
            <p id="thank-you-message1">Your feedback has been successfully submitted.</p>
            <p id="thank-you-message2">Your responses will help us improve the performance review process.</p>
        </div>
    </div>
    
    <div class="footer">
        <p id="required-fields-note">All required fields are marked with an asterisk (*)</p>
    </div>
    
    <script>
        // Language translations
        const translations = {
            en: {
                // Header
                "header-title": "2024 Annual Performance Review Cycle - Employees Survey",
                "header-description": "Your feedback will help us make your next experience even better!",
                
                // Country selection
                "country-label": "Select your country: <span class=\"required\">*</span>",
                "country-placeholder": "-- Select Country --",
                "country-error": "Please select your country",
                
                // Question 1
                "q1-label": "1. How satisfied are you with the 2024 annual performance review cycle? <span class=\"required\">*</span>",
                "q1-option1": "Fully satisfied",
                "q1-option2": "Mostly satisfied",
                "q1-option3": "Mostly unsatisfied",
                "q1-option4": "Very unsatisfied",
                "q1-error": "Please select an option",
                
                // Question 2
                "q2-label": "2. What were the strengths of the 2024 annual performance review? <span class=\"required\">*</span>",
                "q2-error": "Please provide your response",
                
                // Question 3
                "q3-label": "3. What would be your recommendations for improvement for the 2024 annual performance review? <span class=\"required\">*</span>",
                "q3-error": "Please provide your response",
                
                // Question 4
                "q4-label": "4. Did you face any challenges during the 2024 annual performance review? <span class=\"required\">*</span>",
                "q4-option1": "Yes",
                "q4-option2": "No",
                "q4-error": "Please select an option",
                
                // Question 5
                "q5-label": "5. If yes, please specify the main challenge? <span class=\"required\">*</span>",
                "q5-option1": "Tool",
                "q5-option2": "Process",
                "q5-option3": "Clarity of communication",
                "q5-option4": "All of the above",
                "q5-error": "Please select an option",
                
                // Question 6
                "q6-label": "6. How would you assess the support while participating in the 2024 annual performance review? <span class=\"required\">*</span>",
                "q6-description": "(presentation of the performance review campaign, access to information, Workday navigation understanding, answers provided, etc.)",
                "q6-option1": "Excellent",
                "q6-option2": "Good",
                "q6-option3": "Light",
                "q6-option4": "Very light",
                "q6-error": "Please select an option",
                
                // Question 7
                "q7-label": "7. How would you assess the quality of the discussion with your manager while participating in the 2024 annual performance review? <span class=\"required\">*</span>",
                "q7-option1": "Fully satisfied",
                "q7-option2": "Mostly satisfied",
                "q7-option3": "Mostly unsatisfied",
                "q7-option4": "Very unsatisfied",
                "q7-error": "Please select an option",
                
                // Submit button
                "submit-button": "Submit",
                "submitting-text": "Submitting...",
                
                // Thank you page
                "thank-you-title": "Thank You!",
                "thank-you-message1": "Your feedback has been successfully submitted.",
                "thank-you-message2": "Your responses will help us improve the performance review process.",
                
                // Footer
                "required-fields-note": "All required fields are marked with an asterisk (*)"
            },
            fr: {
                // Header
                "header-title": "Cycle annuel de performance 2024 -- questionnaire collaborateurs",
                "header-description": "Vos retours nous aideront à améliorer votre expérience l'année prochaine !",
                
                // Country selection
                "country-label": "Sélectionnez votre pays : <span class=\"required\">*</span>",
                "country-placeholder": "-- Sélectionnez le pays --",
                "country-error": "Veuillez sélectionner votre pays",
                
                // Question 1
                "q1-label": "1. Quel est votre niveau de satisfaction quant au déroulé du cycle annuel d'évaluation de la performance 2024 ? <span class=\"required\">*</span>",
                "q1-option1": "Très satisfait",
                "q1-option2": "Plutôt satisfait",
                "q1-option3": "Plutôt insatisfait",
                "q1-option4": "Très insatisfait",
                "q1-error": "Veuillez sélectionner une option",
                
                // Question 2
                "q2-label": "2. Quels ont été les points forts du cycle d'évaluation de la performance 2024 ? <span class=\"required\">*</span>",
                "q2-error": "Veuillez fournir votre réponse",
                
                // Question 3
                "q3-label": "3. Quels seraient les points d'amélioration du cycle d'évaluation de la performance 2024 ? <span class=\"required\">*</span>",
                "q3-error": "Veuillez fournir votre réponse",
                
                // Question 4
                "q4-label": "4. Avez-vous été confronté.e à des défis pendant le cycle annuel d'évaluation de performance 2024 ? <span class=\"required\">*</span>",
                "q4-option1": "Oui",
                "q4-option2": "Non",
                "q4-error": "Veuillez sélectionner une option",
                
                // Question 5
                "q5-label": "5. Si votre réponse est \"Oui\", veuillez préciser la raison principale ? <span class=\"required\">*</span>",
                "q5-option1": "Outil",
                "q5-option2": "Process",
                "q5-option3": "Clarté de la communication",
                "q5-option4": "Les 3 (réponses A, B et C)",
                "q5-error": "Veuillez sélectionner une option",
                
                // Question 6
                "q6-label": "6. Comment évalueriez-vous l'accompagnement dans le process d'évaluation de la performance ? <span class=\"required\">*</span>",
                "q6-description": "(présentation de la campagne d'évaluation de la performance, disponibilité des informations, facilité à comprendre les fonctionnalités de l'outil, réponses à vos questions éventuelles, etc.)",
                "q6-option1": "Excellent",
                "q6-option2": "Bon",
                "q6-option3": "Faible",
                "q6-option4": "Très Faible",
                "q6-error": "Veuillez sélectionner une option",
                
                // Question 7
                "q7-label": "7. Quelle est votre appréciation de la qualité de l'échange avec votre manager lors de votre entretien annuel de performance 2024 ? <span class=\"required\">*</span>",
                "q7-option1": "Très satisfaisante",
                "q7-option2": "Plutôt satisfaisante",
                "q7-option3": "Plutôt insatisfaisante",
                "q7-option4": "Très insatisfaisante",
                "q7-error": "Veuillez sélectionner une option",
                
                // Submit button
                "submit-button": "Soumettre",
                "submitting-text": "Soumission en cours...",
                
                // Thank you page
                "thank-you-title": "Merci !",
                "thank-you-message1": "Vos commentaires ont été soumis avec succès.",
                "thank-you-message2": "Vos réponses nous aideront à améliorer le processus d'évaluation de la performance.",
                
                // Footer
                "required-fields-note": "Tous les champs requis sont marqués d'un astérisque (*)"
            }
        };
        
        // Function to toggle conditional questions
        function toggleConditionalQuestion(questionId, show) {
            const question = document.getElementById(questionId);
            if (show) {
                question.style.display = 'block';
            } else {
                question.style.display = 'none';
                // Clear any inputs in the hidden conditional question
                const inputs = question.querySelectorAll('input[type="radio"]');
                inputs.forEach(input => input.checked = false);
                
                // Clear any error state
                const errorContainer = question.querySelector('.question');
                if (errorContainer) errorContainer.classList.remove('error');
            }
        }
        
        // Function to validate a question and show/hide error message
        function validateQuestion(questionId, isRequired = true) {
            if (!isRequired) return true;
            
            const question = document.getElementById(questionId);
            let isValid = false;
            
            // For radio buttons
            const radios = question.querySelectorAll('input[type="radio"]');
            if (radios.length > 0) {
                isValid = Array.from(radios).some(radio => radio.checked);
            }
            
            // For select elements
            const select = question.querySelector('select');
            if (select) {
                isValid = select.value !== '';
            }
            
            // For textarea elements
            const textarea = question.querySelector('textarea');
            if (textarea) {
                isValid = textarea.value.trim() !== '';
            }
            
            // Toggle error class
            if (isValid) {
                question.classList.remove('error');
            } else {
                question.classList.add('error');
            }
            
            return isValid;
        }
        
        // Function to validate the entire form
        function validateForm() {
            let isValid = true;
            
            // Required fields
            isValid = validateQuestion('countryQuestion') && isValid;
            isValid = validateQuestion('q1Question') && isValid;
            isValid = validateQuestion('q2Question') && isValid;
            isValid = validateQuestion('q3Question') && isValid;
            isValid = validateQuestion('q4Question') && isValid;
            
            // Conditional validation for q5
            const q4YesRadio = document.querySelector('input[name="q4"][value="Yes"]');
            if (q4YesRadio && q4YesRadio.checked) {
                isValid = validateQuestion('q5Question') && isValid;
            }
            
            isValid = validateQuestion('q6Question') && isValid;
            isValid = validateQuestion('q7Question') && isValid;
            
            return isValid;
        }
        
        // Function to submit the form
        async function submitForm() {
            if (validateForm()) {
                // Show loading state
                const submitButton = document.querySelector('.btn-submit');
                submitButton.disabled = true;
                submitButton.querySelector('.spinner').style.display = 'inline-block';
                submitButton.classList.add('is-loading');
                
                try {
                    // Get the current language
                    const currentLang = document.getElementById('en-toggle').classList.contains('active') ? 'en' : 'fr';
                    
                    // Map values based on language
                    const mapValueByLanguage = (enValue, frValue) => {
                        return currentLang === 'en' ? enValue : frValue;
                    };
                    
                    // Collect form data
                    const formData = {
                        country: document.getElementById('country').value,
                        satisfaction_level: (() => {
                            const checked = document.querySelector('input[name="q1"]:checked');
                            if (!checked) return '';
                            
                            // Map the value based on language
                            const valueMap = {
                                'Fully satisfied': 'Très satisfait',
                                'Mostly satisfied': 'Plutôt satisfait',
                                'Mostly unsatisfied': 'Plutôt insatisfait',
                                'Very unsatisfied': 'Très insatisfait'
                            };
                            
                            return currentLang === 'en' ? checked.value : valueMap[checked.value] || checked.value;
                        })(),
                        strengths: document.getElementById('q2').value,
                        improvement_recommendations: document.getElementById('q3').value,
                        faced_challenges: document.querySelector('input[name="q4"]:checked')?.value === (currentLang === 'en' ? 'Yes' : 'Oui'),
                        main_challenge: (() => {
                            const checked = document.querySelector('input[name="q5"]:checked');
                            if (!checked) return null;
                            
                            // Map the value based on language
                            const valueMap = {
                                'Tool': 'Outil',
                                'Process': 'Process',
                                'Clarity of communication': 'Clarté de la communication',
                                'All of the above': 'Les 3 (réponses A, B et C)'
                            };
                            
                            return currentLang === 'en' ? checked.value : valueMap[checked.value] || checked.value;
                        })(),
                        support_assessment: (() => {
                            const checked = document.querySelector('input[name="q6"]:checked');
                            if (!checked) return '';
                            
                            // Map the value based on language
                            const valueMap = {
                                'Excellent': 'Excellent',
                                'Good': 'Bon',
                                'Light': 'Faible',
                                'Very light': 'Très Faible'
                            };
                            
                            return currentLang === 'en' ? checked.value : valueMap[checked.value] || checked.value;
                        })(),
                        manager_discussion_quality: (() => {
                            const checked = document.querySelector('input[name="q7"]:checked');
                            if (!checked) return '';
                            
                            // Map the value based on language
                            const valueMap = {
                                'Fully satisfied': 'Très satisfaisante',
                                'Mostly satisfied': 'Plutôt satisfaisante',
                                'Mostly unsatisfied': 'Plutôt insatisfaisante',
                                'Very unsatisfied': 'Très insatisfaisante'
                            };
                            
                            return currentLang === 'en' ? checked.value : valueMap[checked.value] || checked.value;
                        })()
                    };
                    
                    console.log('Form data being sent:', JSON.stringify(formData));
                    
                    // Use XMLHttpRequest instead of fetch to ensure proper error handling
                    const xhr = new XMLHttpRequest();
                    xhr.open('POST', '/api/submit-survey.js');  // with .js extension
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    
                    xhr.onload = function() {
                        if (xhr.status >= 200 && xhr.status < 300) {
                            console.log('Success response:', xhr.responseText);
                            try {
                                const result = JSON.parse(xhr.responseText);
                                // Show thank you page
                                document.getElementById('surveyForm').style.display = 'none';
                                document.getElementById('thankYouPage').style.display = 'block';
                                window.scrollTo(0, 0);
                            } catch (e) {
                                console.error('Error parsing response:', e);
                                alert(currentLang === 'en' ? 
                                    'Error processing response. Please try again or contact support.' :
                                    'Erreur de traitement de la réponse. Veuillez réessayer ou contacter le support.'
                                );
                                
                                // Reset button state
                                submitButton.disabled = false;
                                submitButton.querySelector('.spinner').style.display = 'none';
                                submitButton.classList.remove('is-loading');
                            }
                        } else {
                            console.error('Error response:', xhr.status, xhr.responseText);
                            try {
                                const errorResult = JSON.parse(xhr.responseText);
                                alert(currentLang === 'en' ? 
                                    'Error: ' + (errorResult.error || 'Failed to submit survey') + '. Please try again or contact support.' :
                                    'Erreur: ' + (errorResult.error || 'Échec de la soumission du sondage') + '. Veuillez réessayer ou contacter le support.'
                                );
                            } catch (e) {
                                alert(currentLang === 'en' ? 
                                    'Error submitting survey. Please try again or contact support.' :
                                    'Erreur lors de la soumission du sondage. Veuillez réessayer ou contacter le support.'
                                );
                            }
                            
                            // Reset button state
                            submitButton.disabled = false;
                            submitButton.querySelector('.spinner').style.display = 'none';
                            submitButton.classList.remove('is-loading');
                        }
                    };
                    
                    xhr.onerror = function() {
                        console.error('Network error occurred');
                        alert(currentLang === 'en' ? 
                            'Network error occurred. Please check your connection and try again.' :
                            'Une erreur réseau s\'est produite. Veuillez vérifier votre connexion et réessayer.'
                        );
                        
                        // Reset button state
                        submitButton.disabled = false;
                        submitButton.querySelector('.spinner').style.display = 'none';
                        submitButton.classList.remove('is-loading');
                    };
                    
                    xhr.send(JSON.stringify(formData));
                } catch (error) {
                    console.error('Error submitting form:', error);
                    const currentLang = document.getElementById('en-toggle').classList.contains('active') ? 'en' : 'fr';
                    alert(currentLang === 'en' ? 
                        'Error: ' + error.message + '. Please try again or contact support.' :
                        'Erreur: ' + error.message + '. Veuillez réessayer ou contacter le support.'
                    );
                    
                    // Reset button state
                    submitButton.disabled = false;
                    submitButton.querySelector('.spinner').style.display = 'none';
                    submitButton.classList.remove('is-loading');
                }
            } else {
                // Scroll to the first error
                const firstError = document.querySelector('.error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }
        
        // Function to toggle language
        function toggleLanguage(lang) {
            // Update toggle buttons
            document.getElementById('en-toggle').classList.toggle('active', lang === 'en');
            document.getElementById('fr-toggle').classList.toggle('active', lang === 'fr');
            
            // Update all translations
            Object.keys(translations[lang]).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (key.includes('label') || key.includes('description')) {
                        element.innerHTML = translations[lang][key];
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
            
            // Update country placeholder
            const countrySelect = document.getElementById('country');
            countrySelect.options[0].text = lang === 'en' ? '-- Select Country --' : '-- Sélectionnez le pays --';
        }
        
        // Initialize conditional questions
        document.addEventListener('DOMContentLoaded', function() {
            // Check if any conditional question should be visible initially
            const q4YesRadio = document.querySelector('input[name="q4"][value="Yes"]');
            if (q4YesRadio && q4YesRadio.checked) {
                toggleConditionalQuestion('q5ConditionalQuestion', true);
            }
        });
    </script>
</body>
</html>
